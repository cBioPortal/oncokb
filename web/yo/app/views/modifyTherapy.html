<head>
    <link rel="stylesheet" href="styles/modifyWindow.css" type="text/css" >
</head>
<div class="modifyTherapy">
<div class="modal-header">
    <h4 class="modal-title">
        Add Therapy</h4></div>
<div class="modal-body">
    <div class="input-group input-group-sm" style="width: 100%">
        <div ng-repeat="element in therapy">
            <div class="flexRow">
                <div ng-click="addTherapy($index)" class="inputDrugs">
                    <tags-input ng-model="element.tags" display-property="drugName" replace-spaces-with-dashes="false" placeholder="Add drugs" add-from-autocomplete-only="true" on-tag-added="addDruginElement($tag, $index)" on-tag-removed="removeDruginElement($tag, $index)">
                        <auto-complete source="loadDrugs($query)"
                                       min-length="1"
                                       load-on-focus="true"
                                       load-on-empty="false"
                                       template="drugsLibrary"></auto-complete>
                    </tags-input>
                </div>
                <button class="btn btn-default addButton"><i class="fa fa-remove" ng-click="deleteTherapy($index)"></i></button>
            </div>
        </div>
    </div>
</div>




<div class="modal-footer">

    <div style="width: 100%;float:left" class="form-control-static pull-left">
        <div class="form-inline" style="float:left">
            <input type="text" class="form-control searchbox" ng-model="suggestedDrug" uib-typeahead="drug as drug.drugName for drug in processSearchDrugs($viewValue)" typeahead-min-length="1" typeahead-template-url="drugsDropdown.html"/>
            <button class="btn btn-success" ng-click="addDrug(suggestedDrug, preferName)">Add Drug</button>
        </div>
        <div class="form-inline" style="float:left">
            <select chosen
                    ng-model="preferName"
                    data-placeholder="Choose a prefer name"
                    ng-hide="(suggestedDrug == null) || (suggestedDrug === '')"
                    class="form-control searchbox"
                    data-placeholder="Prefer Name"
                    ng-options="synonyms for synonyms in suggestedDrug.synonyms"
                    style="width: 500px;margin-top: 10px;">
                    <option value="suggetedDrug.drugName"></option>
            </select>
            <i ng-hide="(suggestedDrug == null) || (suggestedDrug === '')">You could choose a prefer name or leave it blank.</i>
        </div>
        <div style="color:red; font-size: 15px">{{addDrugMessage}}</div>
        <p class="errorReminder" ng-show="searchDrugsError">Sorry, suggested drugs are unavailable now.</p>

    </div>

    <p class="errorNote" ng-show="addTherapyError">{{therapyErrorMessage}}</p>
    <button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button>
    <button type="button" class="btn btn-primary" ng-click="save()" ng-disabled="addTherapyError">Save</button>
</div>

</div>

<script type="text/ng-template" id="drugsLibrary">
    <div>
        <div ng-bind-html="$highlight($getDisplayText())"></div>
        <div>Also known as
            <span ng-bind-html="$highlight(data.synonyms.join(', '))"></span>
        </div>
    </div>
</script>

<script type="text/ng-template" id="drugsDropdown.html">
    <a class="drugsDropdown">
        <div class="basicName" ng-bind-html="match.model.drugName | uibTypeaheadHighlight:query"></div>
        <div class="alsoKnownAs">Also known as:
            <span ng-bind-html="match.model.synonyms | uibTypeaheadHighlight:query"></span>
        </div>
        <!--add-->
        <div class="alsoKnownAs">Code:
            <span ng-bind-html="match.model.ncitCode | uibTypeaheadHighlight:query"></span>
        </div>
    </a>
</script>


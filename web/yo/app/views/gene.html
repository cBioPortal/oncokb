<div ng-hide="status.rendering" ng-if="gene" class="geneMainDiv">
  <div id="gene">
    <h2>
      <!-- Gene: <span>{{gene.name.text}}</span> -->
      Gene: <span contenteditable="false" ng-model="gene.name.text"></span><comments-dict gene-name="{{::gene.name.text}}"file-editable="fileEditable" comments="gene.name_comments" object="gene" key="name" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>
      <span ng-repeat="collaborator in collaborators">
        <img style="height:30px" ng-src="{{::collaborator.photoUrl}}" uib-tooltip-placement="top" uib-tooltip="{{::collaborator.displayName}}">
      </span>
      <span ng-if="document" class="geneLastModify" ng-show="gene.status_timeStamp.has('lastEdit')">Last edit was made on {{gene.status_timeStamp.get('lastEdit').value.text | date : 'MMM d, h:mm a yyyy'}} by {{gene.status_timeStamp.get('lastEdit').by.text }}</span>
      <span ng-if="document && userRole === 8" class="geneLastModify" ng-show="gene.status_timeStamp.has('lastUpdate')">Last update to database was made on {{gene.status_timeStamp.get('lastUpdate').value.text  | date : 'MMM d, h:mm a'}} by {{gene.status_timeStamp.get('lastUpdate').by.text }}</span>
      <span class="btn-group btn-group-sm pull-right" role="group">
        <button type="button" class="btn btn-default" ng-if="userRole === 8" ng-disabled="disableReview" ng-click="review()">{{reviewMode ? 'Done Review' : 'Review'}}</button>
        <button type="button" class="btn btn-default" ng-click="getData()">Gene</button>
        <button type="button" class="btn btn-default" ng-disabled="!canUndo" ng-click="undo()">Undo</button>
        <button type="button" class="btn btn-default" ng-disabled="!canRedo" ng-click="redo()">Redo</button>
        <button type="button" class="btn btn-default" ng-click="generatePDF()">Download PDF</button>
        <button type="button" class="btn btn-default" ng-click="status.hideAllEmpty=true">
          <i class="fa fa-eye-slash"></i>Hide all empty
        </button>
        <button type="button" class="btn btn-default" ng-click="status.hideAllEmpty=false">
          <i class="fa fa-eye"></i>Show all empty
        </button>
        <button ng-if="userRole === 8" type="button" class="btn btn-default" ng-click="status.hideAllObsolete=true">
          <i class="fa fa-eye-slash"></i>Hide all obsolete
        </button>
        <button ng-if="userRole === 8" type="button" class="btn btn-default" ng-click="status.hideAllObsolete=false">
          <i class="fa fa-eye-slash"></i>Show all obsolete
        </button>
        <button type="button" class="btn btn-default"  ng-click="status.expandAll=true"
                ng-if="(status.numAccordion < 100 && gene.mutations.length < 20) || (status.numAccordion < 200 && gene.mutations.length < 6)">
          <i class="fa fa-expand"></i>Expand all
        </button>
        <button type="button" class="btn btn-default"  ng-click="status.expandAll=false"
                ng-if="(status.numAccordion < 100 && gene.mutations.length < 20) || (status.numAccordion < 200 && gene.mutations.length < 6)">
          <i class="fa fa-compress"></i>Collapse all
        </button>
        <!--<button type="button" class="btn btn-default"  ng-click="status.expandAll=!status.expandAll">-->
          <!--<i class="fa " ng-class="{'fa-compress':status.expandAll, 'fa-expand':!status.expandAll}"></i>-->
          <!--<span ng-if="!status.expandAll">Expand</span><span ng-if="status.expandAll">Collapse</span> all-->
        <!--</button>-->

        <!--<button type="button" class="btn btn-default" ng-click="status.hideAllEmpty=!status.hideAllEmpty">-->
          <!--<i class="fa " ng-class="{'fa-eye':status.hideAllEmpty, 'fa-eye-slash':!status.hideAllEmpty}"></i>-->
          <!--<span ng-if="!status.hideAllEmpty">Hide</span><span ng-if="status.hideAllEmpty">Show</span> all empty-->
        <!--</button>-->
        <!--<button type="button" class="btn btn-default" ng-click="isOpenFunc('hideEmpty')">Hide all empty</button>-->

      </span>

    </h2>
    <p ng-if="!reviewMode && gene.transcripts.asArray().length > 0">Transcript: {{gene.transcripts.asArray()[0].isoform_override.text}}, {{gene.transcripts.asArray()[0].dmp_refseq_id.text}}</p>
      <div ng-if="reviewMode">
          <br/><br/>
          <p class="lead" style="color:red"><b>You are currently in the review mode. Make sure to click done review button to exit!</b></p>
      </div>

    <div ng-if="displayCheck(gene.summary_uuid, gene.summary_review)">
        <h3>{{::gene.summary.display}}:
          <comments-dict file-editable="fileEditable" comments="gene.summary_comments" object="gene" key="summary" gene-name="{{::gene.name.text}}" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>
          <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="gene.summary_eStatus" id="'gene-summary'"></e-status>
          <i class="fa fa-check" ng-class="iconClass('accept', gene.summary_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', gene.summary_review)"  ng-click="accept(null, 'GENE_SUMMARY', null, null, null, null, gene.summary_review)"></i>
          <i class="fa fa-times" ng-class="iconClass('reject', gene.summary_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', gene.summary_review)"  ng-click="reject(null, 'GENE_SUMMARY', null, null, null, null, gene.summary_review)"></i>
        </h3>
        <drive-realtime-string rs="gene.summary_review" uuid="gene.summary_uuid" es="gene.summary_eStatus" fe="fileEditable" t="'p'" object="gene.summary"></drive-realtime-string>
    </div>
    <div ng-if="displayCheck(gene.type_uuid, gene.type_review)">
        <h3 ng-if="reviewMode">Gene Type:
            <i class="fa fa-check" ng-class="iconClass('accept', gene.type_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', gene.type_review)"  ng-click="accept(null, 'GENE_TYPE', null, null, null, null, gene.type_review)"></i>
            <i class="fa fa-times" ng-class="iconClass('reject', gene.type_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', gene.type_review)"  ng-click="reject(null, 'GENE_TYPE', null, null, null, null, gene.type_review)"></i>
        </h3>
        <span style="float:left">
            <drive-realtime-string rs="gene.type_review" uuid="gene.type_uuid" fe="fileEditable" t="'checkbox'" object="gene.type" objecttype="'object'" objectkey="'TSG'" checkboxes="checkboxes['TSG']" checkboxid="'TSG'"></drive-realtime-string>
        </span>
        <span style="float:left">
            <drive-realtime-string rs="gene.type_review" uuid="gene.type_uuid" fe="fileEditable" t="'checkbox'" object="gene.type" objecttype="'object'" objectkey="'OCG'" checkboxes="checkboxes['OCG']" checkboxid="'OCG'"></drive-realtime-string>
        </span>
        <br/>
        <div ng-if="reviewMode">
            <br/>
            <p class="reviewedBG">{{!gene.type_review.get('action') ? gene.type_review.get('lastReviewed')['TSG'] + ' ' + gene.type_review.get('lastReviewed')['OCG'] : gene.type.get('TSG') + ' ' + gene.type.get('OCG')}}
            </p>
            <br/>
        </div>
    </div>
    <div ng-if="displayCheck(gene.background_uuid, gene.background_review)">
        <h3>{{::gene.background.display}}:
            <comments-dict file-editable="fileEditable" comments="gene.background_comments" object="gene" gene-name="{{gene.name.text}}" key="background" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>
            <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="gene.background_eStatus" id="'gene-background'"></e-status>
            <i class="fa fa-check" ng-class="iconClass('accept', gene.background_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', gene.background_review)"  ng-click="accept(null, 'GENE_BACKGROUND', null, null, null, null, gene.background_review)"></i>
            <i class="fa fa-times" ng-class="iconClass('reject', gene.background_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', gene.background_review)"  ng-click="reject(null, 'GENE_BACKGROUND', null, null, null, null, gene.background_review)"></i>
        </h3>
        <drive-realtime-string rs="gene.background_review" uuid="gene.background_uuid"  es="gene.background_eStatus" fe="fileEditable" t="'p'" object="gene.background"></drive-realtime-string>
        <pub-iframe ng-model="gene.background.text"></pub-iframe>
    </div>
    <div ng-if="gene.name.text && !reviewMode">
      <table class="table geneLinks">
        <tbody>
        <tr>
          <td>cBioPortal link: </td>
          <td><a href="https://cbioportal.mskcc.org/ln?q={{::gene.name.text}}" target="_blank">https://cbioportal.mskcc.org/ln?q={{::gene.name.text}}</a></td>
        </tr>
        <tr>
          <td>COSMIC link: </td>
          <td><a href="http://cancer.sanger.ac.uk/cosmic/gene/overview?ln={{::gene.name.text}}" target="_blank">http://cancer.sanger.ac.uk/cosmic/gene/overview?ln={{::gene.name.text}}</a></td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div id="mutation">
    <uib-accordion close-others="false">
      <div ng-repeat="mutation in gene.mutations.asArray()" ng-init="geneStatus[$index] = {}; geneStatus[$index].isOpen=false; geneStatus[$index].oncogenic = false; geneStatus[$index] = {}" class="accordionMarginTop" ng-hide="status.hideAllObsolete && mutation.name_eStatus.get('obsolete') === 'true'">
        <uib-accordion-group is-open="geneStatus[$index].isOpen" class="levelOneHeader" ng-if="displayCheck(mutation.name_uuid, mutation.name_review, mutation.name_review)">
          <uib-accordion-heading >
            <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[$index].isOpen, 'fa-chevron-right': !geneStatus[$index].isOpen}"></i>
            <span>Mutation: </span><span ng-click="stopCollopse($event)" ng-class="{editableBox:mutationNameEditable(mutation.name.text), unEditableBox:!mutationNameEditable(mutation.name.text)}" contenteditable="{{mutationNameEditable(mutation.name.text)}}" ng-model="mutation.name.text"/></span>
            <comments-dict mutation="{{mutation.name.text}}" gene-name="{{::gene.name.text}}" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" file-editable="fileEditable" comments="mutation.name_comments" object="mutation" key="name" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>
            <i class="fa fa-hand-o-left" uib-tooltip-placement="top" uib-tooltip="Red: needs to be curated" ng-show="mutation.oncogenic_eStatus.get('curated')===false || userRole === 8" ng-click="curatedIconClick($event, mutation.oncogenic_eStatus)" ng-class="{'fa-comments-red':mutation.oncogenic_eStatus.get('curated')===false}"></i>
            <span class="pull-right" ng-show="fileEditable && !reviewMode">
                <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="mutation.name_eStatus" id="mutation.name.text  + '-name'"></e-status>
              <span style="margin-right: 20px">
                <i class="fa fa-angle-up" ng-if="$index !== 0" ng-click="move(gene.mutations, $index, $index, $event)"></i>
                <i class="fa fa-angle-down" ng-if="$index !== gene.mutations.length-1" ng-click="move(gene.mutations, $index, $index+2, $event)"></i>
                <i class="fa fa-angle-double-up" ng-if="$index > 1" ng-click="move(gene.mutations, $index, 0, $event)"></i>
                <i ng-if="$index < gene.mutations.length-2" class="fa fa-angle-double-down" ng-click="move(gene.mutations, $index, gene.mutations.length, $event)"></i>
              </span>
              <i ng-click="remove($event, $index)" class="fa fa-trash-o"></i>
            </span>
              <span class="pull-right" ng-if="mutation.name_review.get('removed')">
                    <i class="fa fa-exclamation-triangle fa-comments-red" aria-hidden="true" ></i>
                    <i class="fa fa-check" ng-class="iconClass('accept', mutation.name_review)" style="font-size: medium" aria-hidden="true"  ng-click="confirmDelete($event, 'mutation', mutation, $index)"></i>
                    <i class="fa fa-times" ng-class="iconClass('reject', mutation.name_review)" style="font-size: medium" aria-hidden="true"  ng-click="cancelDelete($event, $index)"></i>
              </span>
          </uib-accordion-heading>
          <uib-accordion ng-if="geneStatus[$index].isOpen || (status.numAccordion < 100 && gene.mutations.length < 20) || (status.numAccordion < 200 && gene.mutations.length < 6)" close-others="false">
            <!-- Oncogenicity -->
            <uib-accordion-group ng-init="geneStatus[$index].shortSummary = {}" ng-if="displayCheck(mutation.oncogenic_uuid, mutation.oncogenic_review, mutation.name_review)" is-open="geneStatus[$index].shortSummary.isOpen" class="levelTwoHeader" ng-hide="((!!geneStatus[$index].shortSummary.hideEmpty) && checkEmpty(mutation, 'oncogenicity')) || (status.hideAllObsolete && mutation.shortSummary_eStatus.get('obsolete') === 'true')">
              <uib-accordion-heading>
                <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[$index].shortSummary.isOpen, 'fa-chevron-right': !geneStatus[$index].shortSummary.isOpen}" ng-click="changeIsOpen(geneStatus[$index].shortSummary.isOpen)"></i>
                <span> Summary of clinical effect</span><span ng-click="stopCollopse($event)" class="curationNoEntry" ng-if="checkEmpty(mutation, 'oncogenicity')">No Entry</span><comments-dict mutation="{{mutation.name.text}}" file-editable="fileEditable" gene-name="{{::gene.name.text}}" comments="mutation.shortSummary_comments" object="mutation" key="shortSummary" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>
                <span class="pull-right" ng-show="fileEditable">
                   <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="mutation.shortSummary_eStatus" id="mutation.name.text  + '-shortSummary'"></e-status>
                </span>
                <span style="margin-right:10px;float:right" ng-show="reviewMode">
                    <i class="fa fa-check" ng-class="iconClass('accept', mutation.oncogenic_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', mutation.oncogenic_review, mutation.name_review)"  ng-click="accept($event, 'Clinical effect', mutation, null, null, null, mutation.oncogenic_review)"></i>
                    <i class="fa fa-times" ng-class="iconClass('reject', mutation.oncogenic_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', mutation.oncogenic_review, mutation.name_review)"  ng-click="reject($event, 'Clinical effect', mutation, null, null, null, mutation.oncogenic_review)"></i>
                </span>
              </uib-accordion-heading>
              <p>
                <strong style="float: left">{{::mutation.oncogenic.display}}:</strong>
                <drive-realtime-string rs="mutation.oncogenic_review" uuid="mutation.oncogenic_uuid" es="mutation.shortSummary_eStatus" fe="fileEditable" t="'checkbox'" object="mutation.oncogenic" checkboxes="checkboxes['oncogenic']" checkboxid="mutation.name.text + '-shortSummary-box-'"></drive-realtime-string>
              </p>
                <!-- Migrate from mutation summary -->
                <span ng-if="userRole === 8">
                <strong>Summary statement:</strong>
                <br/>
                <drive-realtime-string rs="mutation.shortSummary_review" uuid="mutation.shortSummary_uuid" fe="fileEditable" t="'p'" object="mutation.shortSummary" io="geneStatus[$index].shortSummary.isOpen"></drive-realtime-string>
              </span>
                <span>
                <strong>Description of Evidence:</strong>
                <br/>
                <drive-realtime-string rs="mutation.summary_review" uuid="mutation.summary_uuid" fe="fileEditable" t="'p'" object="mutation.summary" io="geneStatus[$index].shortSummary.isOpen"></drive-realtime-string>
              </span>
            </uib-accordion-group>

            <!-- Mutation Effect -->
            <uib-accordion-group ng-init="geneStatus[$index].oncogenic = {}" ng-if="displayCheck(mutation.effect_uuid, mutation.effect_review, mutation.name_review)" is-open="geneStatus[$index].oncogenic.isOpen" class="levelTwoHeader" ng-hide="((!!geneStatus[$index].oncogenic.hideEmpty) && checkEmpty(mutation, 'mutationEffect')) || (status.hideAllObsolete && mutation.oncogenic_eStatus.get('obsolete') === 'true')">
                  <uib-accordion-heading>
                      <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[$index].oncogenic.isOpen, 'fa-chevron-right': !geneStatus[$index].oncogenic.isOpen}" ng-click="changeIsOpen(geneStatus[$index].oncogenic.isOpen)"></i>
                      <span> Summary of biological effect</span><span ng-click="stopCollopse($event)" class="curationNoEntry" ng-if="checkEmpty(mutation, 'mutationEffect')">No Entry</span><comments-dict mutation="{{mutation.name.text}}" file-editable="fileEditable" gene-name="{{::gene.name.text}}" comments="mutation.oncogenic_comments" object="mutation" key="oncogenic" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>
                      <span class="pull-right" ng-show="fileEditable">
                   <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="mutation.oncogenic_eStatus" id="mutation.name.text  + '-oncogenic'"></e-status>
                </span>
                <span style="margin-right:10px;float:right" ng-show="reviewMode">
                    <i class="fa fa-check" ng-class="iconClass('accept', mutation.effect_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', mutation.effect_review, mutation.name_review)"  ng-click="accept($event, 'MUTATION_EFFECT', mutation, null, null, null, mutation.effect_review)"></i>
                    <i class="fa fa-times" ng-class="iconClass('reject', mutation.effect_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', mutation.effect_review, mutation.name_review)"  ng-click="reject($event, 'MUTATION_EFFECT', mutation, null, null, null, mutation.effect_review)"></i>
                </span>
                  </uib-accordion-heading>
                  <div class="mutationEffect">
                      <strong class="header">Mutation effect:</strong>
                      <div class="content">
                          <drive-realtime-string rs="mutation.effect_review" uuid="mutation.effect_uuid" es="mutation.oncogenic_eStatus" fe="fileEditable" t="'checkbox'" object="mutation.effect.value" checkboxes="checkboxes['mutationEffect']" checkboxid="mutation.name.text + '-mutation-effect-box-'" addon="mutation.effect.addOn" ph="' Optional text'"></drive-realtime-string>
                      </div>
                  </div>
                  <span>
                <strong>Description of Evidence:</strong>
                <br/>
                <drive-realtime-string rs="mutation.description_review" uuid="mutation.description_uuid" es="mutation.oncogenic_eStatus" fe="fileEditable" t="'p'" object="mutation.description" io="geneStatus[$index].oncogenic.isOpen"></drive-realtime-string>
              </span>
                  <span>
                <strong>Additional Information (Optional):</strong>
                <br/>
                <drive-realtime-string rs="mutation.short_review" uuid="mutation.short_uuid" es="mutation.oncogenic_eStatus" fe="fileEditable" t="'p'" object="mutation.short" io="geneStatus[$index].oncogenic.isOpen"></drive-realtime-string>
              </span>
              </uib-accordion-group>

            <!-- tumor types -->
            <div ng-repeat="tumor in mutation.tumors.asArray()" ng-init="geneStatus[$parent.$index][$index] = {}; geneStatus[$parent.$index][$index].isOpen = false;" class="accordionMarginTop" ng-hide="status.hideAllObsolete && tumor.name_eStatus.get('obsolete') === 'true'">
              <uib-accordion-group ng-if="displayCheck(null, tumor.name_review, mutation.name_review, tumor.name_review)" is-open="geneStatus[$parent.$parent.$index][$index].isOpen" class="levelTwoHeader">
                <uib-accordion-heading >
                  <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[$parent.$parent.$parent.$parent.$index][$index].isOpen, 'fa-chevron-right': !geneStatus[$parent.$parent.$parent.$parent.$index][$index].isOpen}"></i>
                  <span>Tumor type: </span>
                  <span ng-class="{unEditableBox: true}" contenteditable="false">{{getCancerTypesName(tumor.cancerTypes)}}</span>
                    <i class="fa fa-edit" ng-click="stopCollopse($event); modifyTumorType(tumor)"></i>
                    <span class="original-tumor-type"
                          ng-if="getCancerTypesName(tumor.cancerTypes).toLowerCase() !== tumor.name.text.toLowerCase() && tumor.name.text">Original Tumor Type: {{tumor.name.text}}</span>
                    <comments-dict mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{::gene.name.text}}"file-editable="fileEditable" comments="tumor.name_comments" object="tumor" key="name" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)"></comments-dict>
                  <!--<span ng-click="stopCollopse($event)" ng-class="{unEditableBox: true}" contenteditable="false"/>{{getCancerTypeName(tumor.cancerTypes)}}</span><comments-dict mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{::gene.name.text}}"file-editable="fileEditable" comments="tumor.name_comments" object="tumor" key="name" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)"></comments-dict>-->
                  <span class="pull-right" ng-show="fileEditable">
                    <span style="margin-right: 20px">
                        <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="tumor.name_eStatus" id="tumor.name.text  + '-name'"></e-status>
                        <i class="fa fa-angle-up" ng-if="$index !== 0" ng-click="move(mutation.tumors, $index, $index, $event)"></i>
                      <i class="fa fa-angle-down" ng-if="$index !== mutation.tumors.length-1" ng-click="move(mutation.tumors, $index, $index+2, $event)"></i>
                      <i class="fa fa-angle-double-up" ng-if="$index > 1" ng-click="move(mutation.tumors, $index, 0, $event)"></i>
                      <i ng-if="$index < mutation.tumors.length-2" class="fa fa-angle-double-down" ng-click="move(mutation.tumors,$index, mutation.tumors.length, $event)"></i>
                    </span>
                    <i ng-click="remove($event, $parent.$parent.$parent.$parent.$index, $index)" class="fa fa-trash-o pull-right"></i>
                  </span>
                    <span class="pull-right" ng-if="tumor.name_review.get('removed')">
                    <i class="fa fa-exclamation-triangle fa-comments-red" aria-hidden="true" ></i>
                    <i class="fa fa-check" ng-class="iconClass('accept', mutation.name_review)" style="font-size: medium" aria-hidden="true"  ng-click="confirmDelete($event, 'tumor', tumor, $parent.$parent.$parent.$parent.$parent.$index, $index)"></i>
                    <i class="fa fa-times" ng-class="iconClass('reject', mutation.name_review)" style="font-size: medium" aria-hidden="true"  ng-click="cancelDelete($event, $parent.$parent.$parent.$parent.$parent.$index, $index)"></i>
                    </span>
                </uib-accordion-heading>
                <uib-accordion close-others="false" ng-if="geneStatus[$parent.$parent.$parent.$parent.$index][$index].isOpen">
                  <!--<span><p ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" placeholder="Optional short tumor type summary" ng-model="tumor.shortSummary.text"></p></span>-->
                  <!--<pub-iframe ng-model="tumor.shortSummary.text"></pub-iframe>-->
                <div ng-if="displayCheck(tumor.summary_uuid, tumor.summary_review, mutation.name_review, tumor.name_review)">
                    <h5><b>Tumor Type Summary (Optional): </b>
                    <span style="margin-right:10px;float:right" ng-show="reviewMode">
                        <i class="fa fa-check" ng-class="iconClass('accept', tumor.summary_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', tumor.summary_review, tumor.name_review)"  ng-click="accept($event, 'TUMOR_TYPE_SUMMARY', mutation, tumor, null, null, tumor.summary_review)"></i>
                        <i class="fa fa-times" ng-class="iconClass('reject', tumor.summary_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', tumor.summary_review, tumor.name_review)"  ng-click="reject($event, 'TUMOR_TYPE_SUMMARY', mutation, tumor, null, null, tumor.summary_review)"></i>
                    </span>
                    </h5>
                    <drive-realtime-string rs="tumor.summary_review" uuid="tumor.summary_uuid" es="tumor.summary_eStatus" fe="fileEditable" t="'p'" object="tumor.summary"></drive-realtime-string>
                    <pub-iframe ng-model="tumor.summary.text"></pub-iframe>
                </div>
                  <!-- Prevalence -->
                  <uib-accordion-group ng-if="displayCheck(null, tumor.prevalence_review, mutation.name_review, tumor.name_review)" ng-init="geneStatus[$parent.$parent.$parent.$parent.$index][$index].prevalence={}; geneStatus[$parent.$parent.$parent.$parent.$index][$index].prevalence.isOpen = false" is-open="geneStatus[$parent.$parent.$parent.$parent.$index][$index].prevalence.isOpen" ng-hide="((!!geneStatus[$parent.$parent.$parent.$parent.$index][$index].prevalence.hideEmpty) && !tumor.prevalence.text && !tumor.shortPrevalence.text) || (status.hideAllObsolete && tumor.prevalence_eStatus.get('obsolete') === 'true')" class="levelThreeHeader">
                    <uib-accordion-heading>
                      <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].prevalence.isOpen, 'fa-chevron-right': !geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].prevalence.isOpen}" ng-click="changeIsOpen(geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].isOpen)"></i>
                      <span>{{::tumor.prevalence.display}}: </span>
                      <span class="curationNoEntry" ng-click="stopCollopse($event)" ng-if="tumor.prevalence.text === '' && tumor.shortPrevalence.text === ''">No Entry</span><comments-dict mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{gene.name.text}}" file-editable="fileEditable" comments="tumor.prevalence_comments" object="tumor" key="prevalence" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)"></comments-dict>
                      <span class="pull-right" ng-show="fileEditable">
                         <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="tumor.prevalence_eStatus" id="mutation.name.text + tumor.name.text + '-prevalence'"></e-status>
                      </span>
                        <span style="margin-right:10px;float:right" ng-show="reviewMode">
                            <i class="fa fa-check" ng-class="iconClass('accept', tumor.prevalence_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', tumor.prevalence_review, tumor.name_review)"  ng-click="accept($event, 'PREVALENCE', mutation, tumor, null, null, tumor.prevalence_review)"></i>
                            <i class="fa fa-times" ng-class="iconClass('reject', tumor.prevalence_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', tumor.prevalence_review, tumor.name_review)"  ng-click="reject($event, 'PREVALENCE', mutation, tumor, null, null, tumor.prevalence_review)"></i>
                        </span>
                    </uib-accordion-heading>
                    <drive-realtime-string rs="tumor.prevalence_review" uuid="tumor.prevalence_uuid" es="tumor.prevalence_eStatus" fe="fileEditable" t="'p'" object="tumor.prevalence" io="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].prevalence.isOpen" ph="'Description of Evidence'"></drive-realtime-string>
                    <drive-realtime-string rs="tumor.shortPrevalence_review" uuid="tumor.shortPrevalence_uuid" es="tumor.prevalence_eStatus" fe="fileEditable" t="'p'" object="tumor.shortPrevalence" io="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].prevalence.isOpen" ph="'Additional Information (Optional)'"></drive-realtime-string>
                  </uib-accordion-group>

                  <!-- Prognostic implications -->
                  <uib-accordion-group ng-if="displayCheck(null, tumor.progImp_review, mutation.name_review, tumor.name_review)" ng-init="geneStatus[$parent.$parent.$parent.$parent.$index][$index].progImp={}; geneStatus[$parent.$parent.$parent.$parent.$index][$index].progImp.isOpen = false" is-open="geneStatus[$parent.$parent.$parent.$parent.$index][$index].progImp.isOpen" ng-hide="((!!geneStatus[$parent.$parent.$parent.$parent.$index][$index].progImp.hideEmpty) && !tumor.progImp.text && !tumor.shortProgImp.text) || (status.hideAllObsolete && tumor.progImp_eStatus.get('obsolete') === 'true')" class="levelThreeHeader">
                    <uib-accordion-heading>
                      <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].progImp.isOpen, 'fa-chevron-right': !geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].progImp.isOpen}" ng-click="changeIsOpen(geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].progImp.isOpen)"></i>
                      <span>{{::tumor.progImp.display}}: </span>
                      <span  ng-click="stopCollopse($event)"class="curationNoEntry" ng-if="tumor.progImp.text === '' && tumor.shortProgImp.text === ''">No Entry</span><comments-dict mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{gene.name.text}}"file-editable="fileEditable" comments="tumor.progImp_comments" object="tumor" key="progImp" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)"></comments-dict>
                      <span class="pull-right" ng-show="fileEditable">
                         <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="tumor.progImp_eStatus" id="mutation.name.text + tumor.name.text + '-progImp'"></e-status>
                      </span>
                        <span style="margin-right:10px;float:right" ng-show="reviewMode">
                            <i class="fa fa-check" ng-class="iconClass('accept', tumor.progImp_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', tumor.progImp_review, tumor.name_review)"  ng-click="accept($event, 'PROGNOSTIC_IMPLICATION', mutation, tumor, null, null, tumor.progImp_review)"></i>
                            <i class="fa fa-times" ng-class="iconClass('reject', tumor.progImp_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', tumor.progImp_review, tumor.name_review)"  ng-click="reject($event, 'PROGNOSTIC_IMPLICATION', mutation, tumor, null, null, tumor.progImp_review)"></i>
                        </span>
                    </uib-accordion-heading>
                    <drive-realtime-string rs="tumor.progImp_review" uuid="tumor.progImp_uuid" es="tumor.progImp_eStatus" fe="fileEditable" t="'p'" object="tumor.progImp" io="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].progImp.isOpen" ph="'Description of Evidence'"></drive-realtime-string>
                    <drive-realtime-string rs="tumor.shortProgImp_review" uuid="tumor.shortProgImp_uuid" es="tumor.progImp_eStatus" fe="fileEditable" t="'p'" object="tumor.shortProgImp" io="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].progImp.isOpen" ph="'Additional Information (Optional)'"></drive-realtime-string>
                  </uib-accordion-group>

                  <!-- NCCN guidelines -->
                  <uib-accordion-group ng-if="displayCheck(null, tumor.nccn_review, mutation.name_review, tumor.name_review)" ng-init="geneStatus[$parent.$parent.$parent.$parent.$index][$index].nccn={}; geneStatus[$parent.$parent.$parent.$parent.$index][$index].nccn.isOpen = false" is-open="geneStatus[$parent.$parent.$parent.$parent.$index][$index].nccn.isOpen" ng-hide="((!!geneStatus[$parent.$parent.$parent.$parent.$index][$index].nccn.hideEmpty) && !tumor.nccn.disease.text) || (status.hideAllObsolete && tumor.nccn_eStatus.get('obsolete') === 'true')" class="levelThreeHeader">
                    <uib-accordion-heading>
                      <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].nccn.isOpen, 'fa-chevron-right': !geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].nccn.isOpen}" ng-click="changeIsOpen(geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].nccn.isOpen)"></i>
                      <span>NCCN guidelines: </span>
                      <span ng-click="stopCollopse($event)" class="curationNoEntry" ng-if="tumor.nccn.disease.text === '' || tumor.nccn.disease.text === 'NA'">No Entry</span><comments-dict display-name="NCCN guidelines" mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{gene.name.text}}" file-editable="fileEditable" comments="tumor.nccn_comments" object="tumor" key="nccn" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)"></comments-dict>
                      <span class="pull-right" ng-show="fileEditable">
                         <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="tumor.nccn_eStatus" id="mutation.name.text + tumor.name.text + '-nccn'"></e-status>
                      </span>
                        <span style="margin-right:10px;float:right" ng-show="reviewMode">
                            <i class="fa fa-check" ng-class="iconClass('accept', tumor.nccn_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', tumor.nccn_review, tumor.name_review)"  ng-click="accept($event, 'NCCN_GUIDELINES', mutation, tumor, null, null, tumor.nccn_review)"></i>
                            <i class="fa fa-times" ng-class="iconClass('reject', tumor.nccn_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', tumor.nccn_review, tumor.name_review)"  ng-click="reject($event, 'NCCN_GUIDELINES', mutation, tumor, null, null, tumor.nccn_review)"></i>
                        </span>
                    </uib-accordion-heading>
                    <strong>{{::tumor.nccn.therapy.display}}:</strong>
                    <drive-realtime-string rs="tumor.nccn.therapy_review" uuid="tumor.nccn.therapy_uuid" es="tumor.nccn_eStatus" fe="fileEditable" t="'short'" object="tumor.nccn.therapy"></drive-realtime-string>
                    <p>
                      <strong>{{::tumor.nccn.disease.display}}:</strong>
                      <drive-realtime-string rs="tumor.nccn.disease_review" uuid="tumor.nccn.disease_uuid" es="tumor.nccn_eStatus" t="'select-chosen'" object="tumor.nccn.disease" o="nccnDiseaseTypes" chosenid="'CurationNCCNDropDown'"></drive-realtime-string>
                    </p>
                    <p>
                      <strong>{{::tumor.nccn.version.display}}:</strong>
                      <drive-realtime-string rs="tumor.nccn.version_review" uuid="tumor.nccn.version_uuid" es="tumor.nccn_eStatus" fe="fileEditable" t="'short'" object="tumor.nccn.version"></drive-realtime-string>
                    </p>
                    <!--<p>-->
                      <!--<strong>{{::tumor.nccn.pages.display}}:</strong>-->
                      <!--<drive-realtime-string es="tumor.nccn_eStatus" fe="fileEditable" t="'short'" object="tumor.nccn.pages"></drive-realtime-string>-->
                    <!--</p>-->
                    <!--<p>-->
                      <!--<strong>{{::tumor.nccn.category.display}}:</strong>-->
                      <!--<drive-realtime-string es="tumor.nccn_eStatus" fe="fileEditable" t="'select'" object="tumor.nccn.category" o="nccnCategories"></drive-realtime-string>-->
                    <!--</p>-->
                    <span>
                    <strong>Description of Evidence:</strong>
                    <br/>
                    <drive-realtime-string rs="tumor.nccn.description_review" uuid="tumor.nccn.description_uuid" es="tumor.nccn_eStatus" fe="fileEditable" t="'p'" object="tumor.nccn.description" io="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].nccn.isOpen"></drive-realtime-string>
                    </span>
                    <span>
                    <strong>Additional Information (Optional):</strong>
                    <br/>
                    <drive-realtime-string rs="tumor.nccn.short_review" uuid="tumor.nccn.short_uuid" es="tumor.nccn_eStatus" fe="fileEditable" t="'p'" object="tumor.nccn.short" io="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].nccn.isOpen"></drive-realtime-string>
                    </span>
                  </uib-accordion-group>

                  <!-- Theraputic implications -->
                  <div ng-repeat="ti in tumor.TI.asArray()" class="accordionMarginTop" ng-init="geneStatus[$parent.$parent.$parent.$parent.$parent.$index][$parent.$index][$index] = {}; geneStatus[$parent.$parent.$parent.$parent.$parent.$index][$parent.$index][$index].isOpen = false;" ng-hide="status.hideAllObsolete && ti.name_eStatus.get('obsolete') === 'true'">
                    <uib-accordion-group ng-if="displayCheck(null, ti.name_review, mutation.name_review, tumor.name_review)" is-open="geneStatus[$parent.$parent.$parent.$parent.$parent.$index][$parent.$index][$index].isOpen" class="levelThreeHeader" ng-hide="(!!geneStatus[$parent.$parent.$parent.$parent.$parent.$index][$parent.$index][$index].hideEmpty) && !ti.short.text && !ti.description.text && ti.treatments.length === 0">
                      <uib-accordion-heading>
                        <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$index][$index].isOpen, 'fa-chevron-right': !geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$index][$index].isOpen}" ng-click="changeIsOpen(geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$index][$index].isOpen)"></i>
                        <span>{{::ti.name.text}}: </span>
                        <span ng-click="stopCollopse($event)" class="curationNoEntry" ng-if="!ti.short.text && !ti.description.text && ti.treatments.length === 0">No Entry</span>
                        <comments-dict display-name="{{::ti.name.text}}" mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{::gene.name.text}}" file-editable="fileEditable" comments="ti.name_comments" object="ti" key="name" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)"></comments-dict>
                        <span class="pull-right" ng-show="fileEditable">
                            <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="ti.name_eStatus" id="ti.name.text  + '-name'"></e-status>
                        </span>
                      </uib-accordion-heading>
                      <!--<span><p ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" placeholder="Optional short general summary" ng-model="ti.short.text"></p></span>-->
                      <!--<pub-iframe ng-model="ti.short.text" ng-if="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$index][$index].isOpen"></pub-iframe>-->
                        <div ng-if="displayCheck(ti.description_uuid, ti.description_review, mutation.name_review, tumor.name_review)">
                            <h5><b>General Summary (Optional): </b>
                                <span style="margin-right:10px;float:right" ng-show="reviewMode">
                                    <i class="fa fa-check" ng-class="iconClass('accept', ti.description_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', ti.description_review, tumor.name_review)"  ng-click="accept($event, ti.name.getText(), mutation, tumor, ti, null, ti.description_review)"></i>
                                    <i class="fa fa-times" ng-class="iconClass('reject', ti.description_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', ti.description_review, tumor.name_review)"  ng-click="reject($event, ti.name.getText(), mutation, tumor, ti, null, ti.description_review)"></i>
                                </span>
                            </h5>
                            <drive-realtime-string rs="ti.description_review" uuid="ti.description_uuid" es="ti.description_eStatus" fe="fileEditable" t="'p'" object="ti.description"></drive-realtime-string>
                            <pub-iframe ng-model="ti.description.text" ng-if="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$index][$index].isOpen"></pub-iframe>
                        </div>
                      <uib-accordion close-others="false">
                        <div ng-repeat="treatment in ti.treatments.asArray()" ng-init="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$parent.$parent.$index][$parent.$index][$index]={}; geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$parent.$parent.$index][$parent.$index][$index].isOpen = false;" class="accordionMarginTop">
                          <uib-accordion-group ng-if="displayCheck(null, treatment.name_review, mutation.name_review, tumor.name_review, treatment.name_review)" is-open="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$parent.$parent.$index][$parent.$index][$index].isOpen" class="levelFourHeader" ng-hide="(status.hideAllObsolete && treatment.name_eStatus.get('obsolete') === 'true')">
                            <uib-accordion-heading>
                              <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$index][$index].isOpen, 'fa-chevron-right': !geneStatusgeneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$index][$index].isOpen}"></i>
                              <span>{{treatment.type.text}}: </span>
                              <span ng-click="stopCollopse($event)" ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="treatment.name.text"/></span>
                              <span ng-click="stopCollopse($event)" class="curationNoEntry" ng-if="!treatment.level.text && !treatment.indication.text && !treatment.description.text && !treatment.short.text">No Entry</span>
                              <comments-dict gene-name="{{::gene.name.text}}" therapy="{{treatment.name.text}}" mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" parent-event="$event" file-editable="fileEditable" comments="treatment.name_comments" object="treatment" key="name" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)"></comments-dict>
                              <span class="pull-right" ng-show="fileEditable">
                                <span style="margin-right: 20px">
                                  <i class="fa fa-angle-up" ng-if="$parent.$index !== 0" ng-click="move(ti.treatments, $parent.$index, $parent.$index, $event)"></i>
                                  <i class="fa fa-angle-down" ng-if="$parent.$index !== ti.treatments.length-1" ng-click="move(ti.treatments, $parent.$index, $parent.$index+2, $event)"></i>
                                  <i class="fa fa-angle-double-up" ng-if="$parent.$index > 1" ng-click="move(ti.treatments, $index, 0, $event)"></i>
                                  <i ng-if="$parent.$index < ti.treatments.length-2" class="fa fa-angle-double-down" ng-click="move(ti.treatments, $parent.$index, ti.treatments.length, $event)"></i>
                                </span>
                                 <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="treatment.name_eStatus" id="mutation.name.text + tumor.name.text + ti.name.text + treatment.text"></e-status>
                                <i ng-click="remove($event, $parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index, $parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index, $parent.$parent.$parent.$parent.$parent.$index, $index)" class="fa fa-trash-o"></i>
                              </span>
                            <span style="margin-right:10px;float:right" ng-show="reviewMode && !tumor.name_review.get('removed')">
                                <i class="fa fa-check" ng-class="iconClass('accept', treatment.name_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', treatment.name_review, treatment.name_review)"  ng-click="accept($event, ti.name.getText(), mutation, tumor, ti, treatment, treatment.name_review)"></i>
                                <i class="fa fa-times" ng-class="iconClass('reject', treatment.name_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', treatment.name_review, treatment.name_review)"  ng-click="reject($event, ti.name.getText(), mutation, tumor, ti, treatment, treatment.name_review)"></i>
                            </span>
                            <span class="pull-right" ng-if="treatment.name_review.get('removed')">
                                <i class="fa fa-exclamation-triangle fa-comments-red" aria-hidden="true" ></i>
                                <i class="fa fa-check" ng-class="iconClass('accept', mutation.name_review)" style="font-size: medium" aria-hidden="true"  ng-click="confirmDelete($event, 'treatment', treatment, $parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index, $parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index, $parent.$parent.$parent.$parent.$parent.$parent.$index, $index)"></i>
                                <i class="fa fa-times" ng-class="iconClass('reject', mutation.name_review)" style="font-size: medium" aria-hidden="true"  ng-click="cancelDelete($event, $parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index, $parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index, $parent.$parent.$parent.$parent.$parent.$parent.$index, $index)"></i>
                            </span>
                            </uib-accordion-heading>
                            <p>
                              <strong>{{::treatment.level.display}}:</strong><br/>
                              <span ng-if="checkTI(ti, 1, 1)">
                                <drive-realtime-string rs="treatment.level_review" uuid="treatment.level_uuid" es="treatment.name_eStatus" fe="fileEditable" object="treatment.level" t="'select'" o="levels.SS"></drive-realtime-string>
                              </span>
                              <span ng-if="checkTI(ti, 1, 0)">
                                <drive-realtime-string rs="treatment.level_review" uuid="treatment.level_uuid" es="treatment.name_eStatus" fe="fileEditable" object="treatment.level" t="'select'" o="levels.SR" class="floatLeft"></drive-realtime-string>
                                <i class="fa fa-question-circle" style="color: grey;" uib-tooltip-html="levelExps.SR"></i>
                              </span>
                              <span ng-if="checkTI(ti, 0, 1)">
                                <drive-realtime-string rs="treatment.level_review" uuid="treatment.level_uuid" es="treatment.name_eStatus" fe="fileEditable" object="treatment.level" t="'select'" o="levels.IS"></drive-realtime-string>
                              </span>
                              <span ng-if="checkTI(ti, 0, 0)">
                                <drive-realtime-string rs="treatment.level_review" uuid="treatment.level_uuid" es="treatment.name_eStatus" fe="fileEditable" object="treatment.level" t="'select'" o="levels.IR" class="floatLeft"></drive-realtime-string>
                                <i class="fa fa-question-circle" style="color: grey;" uib-tooltip-html="levelExps.IR"></i>
                              </span>
                            </p>
                            <div class="approvedIndication" ng-if="checkTI(ti, 1, 1)">
                              <div class="header">
                                <strong>{{::treatment.indication.display}}:</strong>
                              </div>
                              <div class="content">
                                <drive-realtime-string rs="treatment.indication_review" uuid="treatment.indication_uuid" es="treatment.name_eStatus" fe="fileEditable" t="'short'" object="treatment.indication" io="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$index][$index].isOpen"></drive-realtime-string>
                              </div>
                            </div>
                            <span>
                              <strong>Description of Evidence:</strong>
                              <br/>
                              <drive-realtime-string rs="treatment.description_review" uuid="treatment.description_uuid" es="treatment.name_eStatus" fe="fileEditable" t="'p'" object="treatment.description" io="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$index][$index].isOpen"></drive-realtime-string>
                            </span>
                            <span>
                              <strong>Additional Information (Optional):</strong>
                              <br/>
                              <drive-realtime-string rs="treatment.short_review" uuid="treatment.short_uuid" es="treatment.name_eStatus" fe="fileEditable" t="'p'" object="treatment.short" io="geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index][$parent.$parent.$parent.$index][$index].isOpen"></drive-realtime-string>
                            </span>
                          </uib-accordion-group>
                        </div>
                        <div ng-if="!reviewMode" class="input-group input-group-sm accordionMarginTop">
                          <input type="text" class="form-control" ng-model="newTIName" placeholder="Therapy name" />
                          <span class="input-group-btn">
                            <button type="button" class="btn btn-default" ng-disabled="!(!!newTIName)" ng-click="addTI(ti, $index, newTIName, $parent.$parent.$parent.$parent.$parent.$parent.$parent.$parent.$index, $parent.$parent.$parent.$parent.$index, $index); newTIName=''">
                              <i class="fa fa-plus"></i> Add Therapy and {{::(ti.types.get('status').toString() === '0'?'Investigational': 'Standard')}} implications
                            </button>
                          </span>
                        </div>
                      </uib-accordion>
                    </uib-accordion-group>
                  </div>

                  <!-- Trials -->
                  <div class="accordionMarginTop" ng-if="displayCheck(tumor.trials_uuid, tumor.trials_review, mutation.name_review, tumor.name_review)">
                    <uib-accordion-group ng-init="geneStatus[$parent.$parent.$parent.$parent.$index][$index].trials={}; geneStatus[$parent.$parent.$parent.$parent.$index][$index].trials.isOpen = false" is-open="geneStatus[$parent.$parent.$parent.$parent.$index][$index].trials.isOpen" class="levelThreeHeader" ng-hide="((!!geneStatus[$parent.$parent.$parent.$parent.$index][$index].trials.hideEmpty) && tumor.trials.length === 0) || status.hideAllObsolete && tumor.trials_eStatus.get('obsolete') === 'true'">
                      <uib-accordion-heading>
                        <i class="fa  " ng-class="{'fa-chevron-down': geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].trials.isOpen, 'fa-chevron-right': !geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].trials.isOpen}" ng-click="changeIsOpen(geneStatus[$parent.$parent.$parent.$parent.$parent.$parent.$index][$index].trials.isOpen)"></i>
                        <span>Ongoing clinical trials: </span>
                        <span ng-click="stopCollopse($event)" class="curationNoEntry" ng-if="tumor.trials.length === 0">No Entry</span><comments-dict display-name="Ongoing clinical trials" mutation="{{mutation.name.text}}" tumor-type="{{tumor.name.text}}" gene-name="{{gene.name.text}}"file-editable="fileEditable" comments="tumor.trials_comments" object="tumor" key="trials" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)"></comments-dict>
                        <span class="pull-right" ng-show="fileEditable">
                            <e-status ng-if="userRole === 8"  ng-click="commentClick($event)" ng-keypress="stopCollopse($event)" object="tumor.trials_eStatus" id="ti.name.text  + '-trials'"></e-status>
                        </span>
                        <span style="margin-right:10px;float:right" ng-if="reviewMode">
                            <i class="fa fa-check" ng-class="iconClass('accept', tumor.trials_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('accept', tumor.trials_review, tumor.name_review)"  ng-click="accept($event, 'CLINICAL_TRIAL', mutation, tumor, null, null, tumor.trials_review)"></i>
                            <i class="fa fa-times" ng-class="iconClass('reject', tumor.trials_review)" style="font-size: medium" aria-hidden="true" ng-if="iconExist('reject', tumor.trials_review, tumor.name_review)"  ng-click="reject($event, 'CLINICAL_TRIAL', mutation, tumor, null, null, tumor.trials_review)"></i>
                        </span>
                      </uib-accordion-heading>
                      <div>
                      <span class="curateTrialItem" ng-repeat="trial in tumor.trials.asArray()">
                        <a ng-href="https://clinicaltrials.gov/show/{{::trial}}" target="_blank">{{::trial}}</a>
                        <i ng-show="fileEditable" ng-click="remove($event, tumor.trials, $index)" class="fa fa-trash-o"></i>
                      </span>
                        <div class="input-group input-group-sm trialsInputGroup">
                          <input type="text" class="form-control" ng-model="newTrial" placeholder="Trial ID" />
                        <span class="input-group-btn">
                          <button type="button" class="btn btn-default" ng-disabled="!(!!newTrial)" ng-click="addTrial(tumor.trials, newTrial, tumor.trials_review, tumor.trials_uuid); newTrial=''">
                            <i class="fa fa-plus"></i> Add Trial
                          </button>
                        <!-- <button type="button" class="btn btn-default" ng-if="userRole === 8" ng-click="cleanTrial(tumor.trials)">
                        <i class="fa fa-plus"></i> Clean Trial
                        </button> -->
                        </span>
                        </div>
                          <br/><br/>
                          <div ng-if="reviewMode && !tumor.trials_review.get('action')" >
                               <span ng-if="tumor.trials_review.get('lastReviewed').length > 0" class="curateTrialItem reviewedBG" ng-repeat="x in tumor.trials_review.get('lastReviewed')">
                                <a ng-href="https://clinicaltrials.gov/show/{{x}}" target="_blank">{{x}}</a>
                              </span>
                              <p class="reviewedBG" ng-if="!tumor.trials_review.get('lastReviewed') || tumor.trials_review.get('lastReviewed').length === 0">No Entry</p>
                          </div>
                      </div>
                    </uib-accordion-group>
                  </div>
                </uib-accordion>
                <!-- <hr/>
                          <h4>Interacting alterations:</h4>
                          <p>
                      <strong><comments-dict file-editable="fileEditable" comments="tumor.interactAlts.alterations_comments" object="tumor.interactAlts" key="alterations" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>{{tumor.interactAlts.alterations.display}}:</strong>
                      <input type='text' ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.interactAlts.alterations.text"/>
                </p>
                <span>
                      <strong><comments-dict file-editable="fileEditable" comments="tumor.interactAlts.description_comments" object="tumor.interactAlts" key="description" add-comment="addComment(arg1,arg2,arg3)"></comments-dict>{{tumor.interactAlts.description.display}}:</strong>
                      <p class="doubleH" type='text' ng-class="{editableBox:fileEditable, unEditableBox:!fileEditable}" contenteditable="{{fileEditable}}" ng-model="tumor.interactAlts.description.text"></p>
                </span> -->
              </uib-accordion-group>
            </div>
          </uib-accordion>
            <div ng-if="!reviewMode" style="width: 100%; margin: 0 5px" class="input-group input-group-sm accordionMarginTop"
                 ng-if="geneStatus[$index].isOpen || (status.numAccordion < 100 && gene.mutations.length < 20) || (status.numAccordion < 200 && gene.mutations.length < 6)">
                <h4>Add tumor type(s)</h4>
                <hr/>
                <div class="add-tumor-type-item" ng-repeat="cancerType in meta.newCancerTypes">
                    Cancer Type: <select chosen
                                       allow-single-deselect="true"
                                       data-placeholder="Choose a main tumor type"
                                       no-results-text="'Could not find any'"t
                                       ng-model="cancerType.mainType"
                                       ng-options="tt.name for tt in oncoTree.mainTypes | orderBy: 'name' track by tt.id">
                    <option value=""></option>
                </select>
                    Subtype:
                    <select style="width: 400px" chosen
                            data-placeholder="Choose a tumor type"
                            no-results-text="'Could not find any'"
                            allow-single-deselect="true"
                            ng-model="cancerType.subtype"
                            ng-options="tt.name for tt in cancerType.oncoTreeTumorTypes | orderBy: 'name' track by tt.code">
                        <option value=""></option>
                    </select>
                </div>
                <button type="button" class="btn btn-default btn-sm"
                        ng-disabled="meta.newMainType.length === 0"
                        ng-click="addTumorType(mutation, $index); meta.newTumorType=''">
                    Add Tumor Type(s)
                </button>
            </div>
        </uib-accordion-group>
      </div>
    </uib-accordion>
  </div>
  <div ng-if="!reviewMode" class="input-group input-group-sm accordionMarginTop">
    <input type="text" class="form-control" ng-model="newMutationName" placeholder="{{addMutationPlaceholder}}"  uib-typeahead="suggestedMutation for suggestedMutation in suggestedMutations | filter:$viewValue:stateComparator" empty-typeahead  ng-click="opened=!opened" focus-me="opened" ng-focus="onFocus($event)" />
    <span class="input-group-btn">
      <button type="button" class="btn btn-default" ng-disabled="!(!!newMutationName)" ng-click="addMutation(newMutationName); newMutationName=''">
        <i class="fa fa-plus"></i> Add Mutation
      </button>
    </span>
  </div>
  <hr/>
  <div id="vus" ng-if="!reviewMode">
    <h3>Variants of Unknown Significance (Investigated and data not found)</h3>
    <div>
      <div ng-repeat="variant in vus.asArray()">
        <vus-item vus="vus" index="$index" file-editable="fileEditable" d-model="model" comments="variant.name_comments"  object="variant" key="name" add-comment="addComment(arg1,arg2,arg3)" ng-click="commentClick($event)" ng-keypress="stopCollopse($event)"></vus-item>
      </div>

      <div class="input-group input-group-sm vusGroup">
        <input type="text" class="form-control" ng-model="newVUSName" placeholder="Variant Name"/>
        <span class="input-group-btn">
          <button type="button" class="btn btn-default" ng-disabled="!(!!newVUSName)"
                  ng-click="addVUSItem(newVUSName, newVUSTime); newVUSName=''">
            <i class="fa fa-plus"></i> Add Variant
          </button>
        </span>
      </div>
    </div>
  </div>
</div>
<div ng-hide="status.rendering" class="floatToolBox btn-group btn-group-sm" role="group">
  <span class="btn btn-default" style="opacity: 1" disabled>{{::gene.name.text}}</span>
  <button type="button" class="btn btn-default" ng-disabled="!canUndo" ng-click="undo()">Undo</button>
  <button type="button" class="btn btn-default" ng-disabled="!canRedo" ng-click="redo()">Redo</button>
  <button type="button" class="btn btn-default" ng-click="generatePDF()">Download PDF</button>
  <button type="button" class="btn btn-default" ng-click="status.hideAllEmpty=true">
    <i class="fa fa-eye-slash"></i>Hide all empty
  </button>
  <button type="button" class="btn btn-default" ng-click="status.hideAllEmpty=false">
    <i class="fa fa-eye"></i>Show all empty
  </button>
  <button ng-if="userRole === 8" type="button" class="btn btn-default" ng-click="status.hideAllObsolete=true">
    <i class="fa fa-eye-slash"></i>Hide all obsolete
  </button>
  <button ng-if="userRole === 8" type="button" class="btn btn-default" ng-click="status.hideAllObsolete=false">
    <i class="fa fa-eye-slash"></i>Show all obsolete
  </button>
    <button type="button" class="btn btn-default" ng-click="status.expandAll=true"
            ng-if="(status.numAccordion < 100 && gene.mutations.length < 20) || (status.numAccordion < 200 && gene.mutations.length < 6)">
    <i class="fa fa-expand"></i>Expand all
  </button>
  <button type="button" class="btn btn-default"  ng-click="status.expandAll=false"
          ng-if="(status.numAccordion < 100 && gene.mutations.length < 20) || (status.numAccordion < 200 && gene.mutations.length < 6)">
    <i class="fa fa-compress"></i>Collapse all
  </button>
  <!--<button type="button" class="btn btn-default"  ng-click="status.expandAll=!status.expandAll">-->
    <!--<i class="fa " ng-class="{'fa-compress':status.expandAll, 'fa-expand':!status.expandAll}"></i>-->
    <!--<span ng-if="!status.expandAll">Expand</span><span ng-if="status.expandAll">Collapse</span> all-->
  <!--</button>-->
  <!--<button type="button" class="btn btn-default" ng-click="status.hideAllEmpty=!status.hideAllEmpty">-->
    <!--<i class="fa " ng-class="{'fa-eye':status.hideAllEmpty, 'fa-eye-slash':!status.hideAllEmpty}"></i>-->
    <!--<span ng-if="!status.hideAllEmpty">Hide</span><span ng-if="status.hideAllEmpty">Show</span> all empty-->
  <!--</button>-->
  <!--<button type="button" class="btn btn-default" ng-if="userRole === 8" ng-click="getData()">Check gene data</button>-->
  <button ng-style="{color: updateGeneColor()}" type="button" class="btn btn-default" ng-if="userRole === 8 && $root.internal" ng-click="updateGene()"><span ng-show="!!!docStatus.savedGene"><i class="fa fa-spinner fa-spin"></i></span><span ng-show="!!docStatus.savedGene">Update gene</span></button>
  <!--<button type="button" class="btn btn-default" ng-if="userRole === 8" ng-click="getComments()">Check comments</button>-->
    <!--<button type="button" class="btn btn-default" ng-if="userRole === 8" ng-click="checkScope()">Check Scope</button>-->
  <span class="btn btn-default" disabled><span ng-show="docStatus.saving">Saving <i class="fa fa-spinner fa-spin"></i></span><span ng-show="docStatus.saved">All changes saved</span><span style="color: red; font-weight: bold;" ng-show="docStatus.closed">Error saving the changes, please refresh the page</span></span>
</div>

<loading ng-model="status.rendering" content="Please wait, we are loading gene information."></loading>
